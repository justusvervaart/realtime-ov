name: Monitor Waittimes Securityefilters Schiphol

on:
  workflow_dispatch:
  push:
  schedule:
    - cron: '0,15,30,45 * * * *'  # Voert elke 15 minuten uur uit

jobs:
  check-wait-times:
    runs-on: ubuntu-latest
    steps:
    - name: Install JQ
      run: sudo apt-get install jq

    - name: Check Wait Times for All Locations
      run: |
        data=$(curl -s "https://www.schiphol.nl/api/proxy/v3/waittimes/security-filters")
        
        for key in $(echo $data | jq -r 'keys[]'); do
            wait_time=$(echo $data | jq -r --arg KEY $key '.[$KEY].waitTimeInSeconds')
            echo "Location $key has a wait time of $wait_time seconds."

            if (( wait_time > 3600 )); then
              echo "Alert! Location $key has exceeded the threshold with a wait time of $wait_time seconds."
              exit 1
            fi
        done
